<div class="relative flex flex-auto w-full lg:max-h-110 bg-card dark:bg-transparent">

    <!-- Requests list -->
    <div class="relative flex flex-auto flex-col w-full min-w-0 lg:min-w-125 lg:max-w-125 max-h-110 border-r z-10 ">

       <!-- Pagination -->
        <div class="items-center dark:bg-transparent">
            <mat-paginator [pageIndex]="pageIndex"
                        [pageSize]="pageSize"
                        [pageSizeOptions]="pageSizeOptions"
                        [length]="totalRequests"
                        (page)="onPageChange($event)"
                        style="font-size:12px;">
            </mat-paginator>
        </div>

        <!-- List of items -->
        <div class="overflow-y-auto">
            <!-- Item loop -->
            <ng-container *ngFor="let request of loanRequests">
                <!-- Item -->
                <a (click)="viewDetails(request)" class="block">
                    <div class="rounded-lg overflow-hidden border py-4 hover:bg-gray-50 transition-colors duration-200">
                        <!-- Left section -->
                        <div class="flex flex-col px-4">
                            <!-- User name -->
                            <div class="font-semibold text-lg text-primary">{{ userMap[request.UserID]?.firstname }} {{ userMap[request.UserID]?.lastname }}</div>
                            <!-- Loan amount -->
                            <div class="text-gray-600">{{ request.Amount }}</div>
                        </div>
                        <!-- Right section -->
                        <div class="flex flex-col items-end px-4">
                            <!-- Date -->
                            <div class="text-gray-400">{{ request.createdAt | date:'medium' }}</div>
                        </div>
                    </div>
                </a>
            </ng-container>

        </div>

    </div>


    <div class="w-full h-full p-4 bg-gray-100" *ngIf="selectedRequest">
        <!-- Request details card -->
        <div class="h-full rounded-lg overflow-hidden shadow-lg bg-white dark:bg-gray-800">
            <!-- Header -->
            <div class="z-10 relative flex flex-col flex-0 w-full border-b">

                <!-- Toolbar -->
                <div class="flex items-center min-h-16 px-4 md:px-6 border-b bg-gray-50 dark:bg-transparent">

                     <!-- Back button -->
                <a
                class="lg:hidden md:-ml-2"
                mat-icon-button
                [routerLink]="['./../']">
                <mat-icon [svgIcon]="'heroicons_outline:arrow-long-left'"></mat-icon>
            </a>

            <!-- Toggle labels button & menu -->

            <mat-menu #toggleLabelMenu="matMenu">
                <ng-container>

                </ng-container>
            </mat-menu>
            <!-- Other actions button & menu -->
            <button
                class="ml-full"
                mat-icon-button
                [matMenuTriggerFor]="mailMenu">
                <mat-icon [svgIcon]="'heroicons_outline:ellipsis-vertical'"></mat-icon>
            </button>
            <mat-menu #mailMenu="matMenu">
                <button mat-menu-item (click)="deleteRequest(selectedRequest.UserID, selectedRequest.id)">
                    <mat-icon [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                    <span>Delete</span>
                </button>
            </mat-menu>
            </div>

            <!-- Content -->
            <div class="lg:overflow-y-auto max-h-96 p-6"> <!-- Added max-h-96 for limiting height -->
                <!-- Loan Amount -->
                <div class="mb-6">
                    <p class="text-lg font-semibold text-gray-800 dark:text-gray-200">Advance Amount:</p>
                    <p class="text-lg text-gray-600 dark:text-gray-400">{{ selectedRequest.Amount }}</p>
                </div>

                <!-- Reason for Loan -->
                <div class="mb-6">
                    <p class="text-lg font-semibold text-gray-800 dark:text-gray-200">Reason for the advance:</p>
                    <p class="text-lg text-gray-600 dark:text-gray-400">{{ selectedRequest.reason }}</p>
                </div>

            </div>
            <!-- Footer -->
            <div class="flex items-center justify-center flex-auto border-t bg-gray-50 dark:bg-transparent">
                <!-- Buttons -->
                <ng-container *ngIf="selectedRequest && selectedRequest.status === 'pending'">
                    <div class="flex flex-wrap">
                        <!-- Approve -->
                        <button class="m-2" mat-stroked-button [color]="'primary'" (click)="approveAndShowDetails(selectedRequest.UserID, selectedRequest.id,selectedRequest)">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:arrow-uturn-left'"></mat-icon>
                            <span class="ml-2">Approve</span>
                        </button>
                        <!-- Refuse -->
                        <button class="m-2" mat-stroked-button [color]="'primary'" (click)="refuseRequest(selectedRequest.UserID, selectedRequest.id,selectedRequest)">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:arrow-uturn-left'"></mat-icon>
                            <span class="ml-2">Refuse</span>
                        </button>
                    </div>
                </ng-container>
                <ng-container *ngIf="selectedRequest && (selectedRequest.status === 'approved' || selectedRequest.status === 'refused')">
                    <div class="flex flex-wrap">
                        <span class="m-2">{{ selectedRequest.status }}</span>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</div>

<div class="w-full h-full p-4" *ngIf="!selectedRequest">
    <!-- Select request to read -->
<div class=" h-full w-full flex flex-col flex-auto items-center justify-center bg-gray-100 dark:bg-transparent">
   <mat-icon
       class="icon-size-24"
       [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
   <div class="mt-4 text-2xl font-semibold tracking-tight text-secondary">Select a request to read</div>
</div>
</div>
</div>
